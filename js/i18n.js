// 国际化翻译配置
const translations = {
    zh: {
        header: {
            firmName: '美国信律恒达律师事务所'
        },
        nav: {
            about: '关于我们',
            services: '知识产权和跨境电商',
            appointment: '移民',
            contact: '联系我们'
        },
        about: {
            title: '关于我们',
            firmName: '恒达律师事务所',
            paragraph1: '恒达律师事务所（Hengda Law Firm）总部位于纽约，是一家专注于美国移民法与跨境商业合规及争议解决的精品律师事务所，长期服务中国与美国客户，深耕跨境电商、科技与创作者型业务。我们以法律标准与证据体系为核心，代理 EB-1A、NIW、O-1、L-1、EB-5 等高端职业与投资类移民事务，并为企业客户提供公司架构与交易文件（LLC / Corporation）、平台合规、知识产权保护，以及 Schedule A / TRO、CPSC 产品安全合规与调查、Amazon APEX 等关键风险事项的策略应对。',
            paragraph2: '本所律师持有纽约州与新泽西州律师执业资格，并具备在纽约南区联邦地区法院（S.D.N.Y.）、纽约东区联邦地区法院（E.D.N.Y.）、伊利诺伊州北区联邦地区法院（N.D. Ill.）及伊利诺伊州南区联邦地区法院（S.D. Ill.）的出庭资格。',
            paragraph3: '',
            value1: '专业',
            value2: '专注',
            value3: '高效',
            value4: '信赖'
        },
        services: {
            title: '业务领域',
            civil: '民事诉讼',
            immigration: '移民法律',
            familylaw: '婚姻家事',
            realproperty: '房地产法律',
            personalinjury: '人身伤害',
            criminal: '刑事辩护',
            business: '商业法律',
            ip: '知识产权'
        },
        appointment: {
            title: '预约律师咨询',
            heading: '免费案件评估',
            description: '请填写以下信息，我们的律师团队将在24小时内与您联系，为您提供免费的案件初步评估和法律咨询建议。',
            name: '姓名',
            phone: '联系电话',
            email: '电子邮箱',
            caseType: '案件类型',
            selectCase: '请选择案件类型',
            message: '案件简述',
            messagePlaceholder: '请简要描述您的法律问题或案件情况...',
            submit: '提交预约申请',
            other: '其他'
        },
        footer: {
            title: '联系我们',
            availability: '24/7',
            subtitle: '如果您有任何法律需求，请随时与我们联系',
            firmName: '美国信律恒达律师事务所',
            phone: '电话',
            address: '地址',
            email: '邮箱',
            wechat: '微信',
            officeHours: '办公时间',
            officeHoursContent: '周一至周六 9:00 AM - 5:30 PM<br>周日（仅限预约）',
            wechatQRCode: '微信二维码',
            mapTitle: '办公地点'
        },
        joinus: {
            title: '加入我们',
            positions: '招聘职位：Law Clerk（法律助理）',
            jobDuties: '工作内容：',
            duty1: '协助律师进行法律检索与材料整理',
            duty2: '起草、整理和校对法律文件',
            duty3: '协助准备法院或移民申请材料',
            duty4: '管理案件档案，与客户或机构沟通',
            duty5: '完成律师交办的其他工作',
            requirements: '岗位要求：',
            requirement1: '毕业于美国法学院（JD优先）',
            requirement2: '中英文读写良好，能够处理双语文件',
            requirement3: '工作认真、细心、有责任感',
            requirement4: '有律所或相关经验',
            workArrangement: '工作安排：',
            location: '工作地点：纽约曼哈顿',
            applicationMethod: '申请方式：',
            applicationInfo: '请将简历发送至：info@hengdalawfirm.com',
            emailSubject: '邮件标题注明："Law Clerk – 姓名"'
        }
    },
    en: {
        header: {
            firmName: 'Heng Da Law Firm'
        },
        nav: {
            about: 'About Us',
            services: 'IP & Cross-border E-commerce',
            appointment: 'Immigration',
            contact: 'Contact Us'
        },
        about: {
            title: 'About Us',
            firmName: 'Hengda Law Firm',
            paragraph1: 'Hengda Law Firm is a New York–based boutique focused on U.S. immigration and cross-border commercial compliance and disputes, serving clients across the United States and China, with particular depth in e-commerce, technology, and creator-led businesses. We advise on sophisticated employment- and investment-based immigration matters—EB-1A, NIW, O-1, L-1, and EB-5—through disciplined, evidence-driven advocacy and structured legal briefing. We also counsel businesses on entity structuring and core commercial documentation (LLC/corporation formation), platform compliance, intellectual property protection, and targeted risk response for Schedule A/TRO matters, CPSC product safety compliance and investigations, and Amazon APEX proceedings.',
            paragraph2: 'Our attorneys are admitted to practice in New York and New Jersey and hold court admissions in the U.S. District Court for the Southern District of New York (S.D.N.Y.), the Eastern District of New York (E.D.N.Y.), the Northern District of Illinois (N.D. Ill.), and the Southern District of Illinois (S.D. Ill.).',
            paragraph3: '',
            value1: '',
            value2: 'Dedicated Approach.',
            value3: 'Efficient Results.',
            value4: 'Trusted by Clients.'
        },
        services: {
            title: 'Practice Areas',
            civil: 'Civil Litigation',
            immigration: 'Immigration Law',
            familylaw: 'Family Law',
            realproperty: 'Real Estate Law',
            personalinjury: 'Personal Injury',
            criminal: 'Criminal Defense',
            business: 'Business Law',
            ip: 'Intellectual Property'
        },
        appointment: {
            title: 'Book a Free Attorney Consultation',
            heading: 'Free Case Evaluation',
            description: 'Please fill out the information below, and our legal team will contact you within 24 hours to provide a free preliminary case assessment and legal consultation.',
            name: 'Name',
            phone: 'Phone',
            email: 'Email',
            caseType: 'Case Type',
            selectCase: 'Please select case type',
            message: 'Case Description',
            messagePlaceholder: 'Please briefly describe your legal issue or case...',
            submit: 'Submit Appointment',
            other: 'Other'
        },
        footer: {
            title: 'Contact Us',
            availability: '24/7',
            subtitle: 'If you require any legal assistance, please do not hesitate to contact us.',
            firmName: 'Heng Da Law Firm',
            phone: 'Phone',
            address: 'Address',
            email: 'Email',
            wechat: 'WeChat',
            officeHours: 'Office Hours',
            officeHoursContent: 'Monday - Saturday: 9:00 AM - 5:30 PM<br>Sunday: By Appointment Only',
            wechatQRCode: 'WeChat QR Code',
            mapTitle: 'Office Location'
        },
        joinus: {
            title: 'Join Us',
            positions: 'Position: Law Clerk',
            jobDuties: 'Job Responsibilities:',
            duty1: 'Conduct legal research and assist with document review',
            duty2: 'Draft, organize, and proofread legal documents',
            duty3: 'Assist with preparation and filing of court or immigration applications',
            duty4: 'Maintain case files and communicate with clients or agencies',
            duty5: 'Perform other tasks assigned by supervising attorneys',
            requirements: 'Requirements:',
            requirement1: 'Graduate of a U.S. law school (J.D. preferred)',
            requirement2: 'Strong English and Chinese reading/writing skills; able to work with bilingual documents',
            requirement3: 'Detail-oriented, responsible, and organized',
            requirement4: 'Prior law firm or relevant experience preferred',
            workArrangement: 'Work Arrangement:',
            location: 'Location: Manhattan, New York',
            applicationMethod: 'How to Apply:',
            applicationInfo: 'Please send your resume to info@hengdalawfirm.com',
            emailSubject: 'Email subject line: "Law Clerk – [Your Name]"'
        }
    }
};

// 获取当前语言（始终从localStorage读取最新值）
function getCurrentLang() {
    return localStorage.getItem('language') || 'zh';
}

// 获取翻译文本
function t(key) {
    const currentLang = getCurrentLang();
    const keys = key.split('.');
    let value = translations[currentLang];

    for (const k of keys) {
        value = value[k];
        if (!value) return key;
    }

    return value;
}

// 切换语言
function switchLanguage(lang) {
    if (lang && (lang === 'zh' || lang === 'en')) {
        localStorage.setItem('language', lang);
        updatePageLanguage();
    }
}

// 更新页面语言
function updatePageLanguage() {
    const currentLang = getCurrentLang();

    // 更新所有带有 data-i18n 属性的元素
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        element.textContent = t(key);
    });

    // 更新HTML内容（支持<br>等标签）
    document.querySelectorAll('[data-i18n-html]').forEach(element => {
        const key = element.getAttribute('data-i18n-html');
        element.innerHTML = t(key);
    });

    // 更新placeholder
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.placeholder = t(key);
    });

    // 更新语言选择器状态
    const langZh = document.getElementById('lang-zh');
    const langEn = document.getElementById('lang-en');
    if (langZh && langEn) {
        if (currentLang === 'zh') {
            langZh.classList.add('active');
            langEn.classList.remove('active');
        } else {
            langZh.classList.remove('active');
            langEn.classList.add('active');
        }
    }

    // 触发自定义事件，让其他模块知道语言已切换
    document.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang: currentLang } }));
}

// 页面加载时初始化语言
document.addEventListener('DOMContentLoaded', function() {
    updatePageLanguage();

    // 监听DOM变化，当新内容加载时自动应用语言
    let updateTimeout;
    const observer = new MutationObserver(function(mutations) {
        // 使用防抖避免频繁更新
        clearTimeout(updateTimeout);
        updateTimeout = setTimeout(function() {
            const hasNewContent = mutations.some(mutation =>
                mutation.addedNodes.length > 0 &&
                Array.from(mutation.addedNodes).some(node =>
                    node.nodeType === 1 && // 只处理元素节点
                    (node.querySelector('[data-i18n]') || node.hasAttribute('data-i18n'))
                )
            );
            if (hasNewContent) {
                updatePageLanguage();
            }
        }, 100);
    });

    // 监听整个body的变化
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});

// 导出到全局
window.t = t;
window.switchLanguage = switchLanguage;
window.getCurrentLang = getCurrentLang;
